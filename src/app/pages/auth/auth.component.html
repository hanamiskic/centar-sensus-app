<section class="auth-section">
  <img src="assets/hero (7).jpg" alt="Hero" class="background-img" loading="eager" />
  <div class="overlay"></div>

  <div class="auth-container">
    <h2>{{ isRegisterMode ? 'Registracija' : 'Prijava' }}</h2>

    <form (ngSubmit)="onSubmit()" #authForm="ngForm" class="auth-form" novalidate>
      <ng-container *ngIf="isRegisterMode; else loginForm">
        <div class="input-group">
          <input
            type="text"
            placeholder="Ime"
            required
            [(ngModel)]="firstName"
            name="firstName"
            #firstNameInput="ngModel"
          />
          <div *ngIf="firstNameInput.invalid && firstNameInput.touched" class="error">
            Ime je obavezno
          </div>
        </div>

        <div class="input-group">
          <input
            type="text"
            placeholder="Prezime"
            required
            [(ngModel)]="lastName"
            name="lastName"
            #lastNameInput="ngModel"
          />
          <div *ngIf="lastNameInput.invalid && lastNameInput.touched" class="error">
            Prezime je obavezno
          </div>
        </div>

        <!-- REGISTRACIJA: e-mail s pattern validacijom -->
        <div class="input-group">
          <input
            type="email"
            placeholder="Email"
            required
            email
            [pattern]="emailPattern"
            [(ngModel)]="email"
            name="email"
            #emailInput="ngModel"
            autocapitalize="off"
            autocomplete="email"
            spellcheck="false"
          />
          <div
            *ngIf="emailInput.touched && (emailInput.errors?.['email'] || emailInput.errors?.['pattern'])"
            class="error"
          >
            Neispravan format e-mail adrese
          </div>
        </div>

        <div class="input-group password-group">
          <input
            [type]="isPasswordVisible ? 'text' : 'password'"
            placeholder="Lozinka"
            required
            minlength="8"
            [(ngModel)]="password"
            name="password"
            #passInput="ngModel"
            autocomplete="new-password"
          />
          <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
            <i class="fas" [ngClass]="isPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="passInput.invalid && passInput.touched" class="error">
          Lozinka mora imati najmanje 8 znakova
        </div>

        <div class="input-group password-group">
          <input
            [type]="isPasswordVisible ? 'text' : 'password'"
            placeholder="Potvrdi lozinku"
            required
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            #confirmInput="ngModel"
            autocomplete="new-password"
          />
          <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
            <i class="fas" [ngClass]="isPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"></i>
          </button>
        </div>
        <div *ngIf="confirmInput.invalid && confirmInput.touched" class="error">
          Potvrda lozinke je obavezna
        </div>

        <div *ngIf="password && confirmPassword && password !== confirmPassword" class="error">
          Lozinke se ne podudaraju
        </div>

        <div class="radio-section">
          <label class="radio-label">Član udruge:</label>
          <div class="radio-group">
            <label><input type="radio" name="memberType" [(ngModel)]="membership" value="redovni" required /> DA - redovni</label>
            <label><input type="radio" name="memberType" [(ngModel)]="membership" value="podupiruci" required /> DA - podupirući</label>
            <label><input type="radio" name="memberType" [(ngModel)]="membership" value="ne" required /> NE</label>
          </div>
        </div>

        <div class="input-group">
          <input type="tel" placeholder="Broj mobitela (opcionalno)" [(ngModel)]="phone" name="phone" />
        </div>

        <!-- Submit onemogućen dok je forma nevaljana ili lozinke ne odgovaraju -->
        <button
          type="submit"
          [disabled]="authForm.invalid || (isRegisterMode && password !== confirmPassword)"
        >
          Registriraj se
        </button>
      </ng-container>

      <ng-template #loginForm>
        <!-- PRIJAVA: e-mail s istom pattern validacijom -->
        <div class="input-group">
          <input
            type="email"
            placeholder="Email"
            required
            email
            [pattern]="emailPattern"
            [(ngModel)]="email"
            name="email"
            #loginEmailInput="ngModel"
            autocapitalize="off"
            autocomplete="email"
            spellcheck="false"
          />
          <div
            *ngIf="loginEmailInput.touched && (loginEmailInput.errors?.['email'] || loginEmailInput.errors?.['pattern'])"
            class="error"
          >
            Neispravan format e-mail adrese
          </div>
        </div>

        <div class="input-group password-group">
          <input
            [type]="isPasswordVisible ? 'text' : 'password'"
            placeholder="Lozinka"
            required
            [(ngModel)]="password"
            name="password"
            autocomplete="current-password"
          />
          <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
            <i class="fas" [ngClass]="isPasswordVisible ? 'fa-eye-slash' : 'fa-eye'"></i>
          </button>
        </div>

        <!-- Submit onemogućen dok login email nije valjan ili lozinka prazna -->
        <button type="submit" [disabled]="loginEmailInput?.invalid || !password">
          Prijavi se
        </button>
      </ng-template>
    </form>

    <div *ngIf="successMessage" class="success-msg">{{ successMessage }}</div>
    <div *ngIf="errorMessage" class="error-msg">{{ errorMessage }}</div>

    <p class="switch-mode">
      {{ isRegisterMode ? 'Već imate račun?' : 'Nemate račun?' }}
      <a (click)="toggleMode()">
        {{ isRegisterMode ? 'Prijavite se' : 'Registrirajte se' }}
      </a>
    </p>
  </div>
</section>
