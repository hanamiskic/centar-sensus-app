<h1 class="events-header">üìÖ Dogaƒëaji</h1>

<!-- Admin: gumb za dodavanje -->
<div *ngIf="isAdmin" class="admin-actions">
  <button class="primary-btn" type="button" (click)="showForm = !showForm">
    {{ showForm ? 'Zatvori formu' : '‚ûï Dodaj dogaƒëaj' }}
  </button>
</div>

<!-- FORMA: DODAVANJE -->
<div *ngIf="showForm && isAdmin" class="event-form">
  <div class="field">
    <label>Naslov dogaƒëaja</label>
    <input [(ngModel)]="formData.naslov" type="text" />
  </div>

  <div class="field">
    <label>Ciljna populacija:</label>
    <select [(ngModel)]="formData.ciljnaPopulacija">
      <option value="SVI">SVI</option>
      <option value="DJECA">DJECA</option>
      <option value="DJECA I MLADI">DJECA I MLADI</option>
      <option value="≈ΩENE">≈ΩENE</option>
      <option value="ODRASLI">ODRASLI</option>
      <option value="ODGAJATELJI">ODGAJATELJI</option>
      <option value="RODITELJI I BUDUƒÜI RODITELJI">RODITELJI i BUDUƒÜI RODITELJI</option>
    </select>
  </div>

  <div class="field">
    <label>Slika</label>
    <input type="file" accept="image/*" (change)="onFileSelected($event)" />
  </div>

  <div class="field">
    <label>Opis</label>
    <textarea [(ngModel)]="formData.opis"></textarea>
  </div>

  <div class="field">
    <label>Datum i vrijeme</label>
    <input [(ngModel)]="formData.datumVrijeme" type="datetime-local" />
  </div>

  <div class="field">
    <label>Mjesto odr≈æavanja</label>
    <input [(ngModel)]="formData.mjesto" type="text" />
  </div>

  <div class="field">
    <label>Maksimalan broj sudionika</label>
    <input
      [(ngModel)]="formData.maxSudionika"
      type="number" min="1" step="1"
      (keydown)="blockNonNumericKey($event)"
      (input)="normalizeMaxSudionika()" />
  </div>

  <div class="form-buttons">
    <button class="save-btn" type="button" (click)="addEvent()" [disabled]="!isFormValid()">Spremi</button>
    <button class="cancel-btn" type="button" (click)="showForm=false">Odustani</button>
  </div>
</div>

<!-- FORMA: UREƒêIVANJE -->
<div *ngIf="isAdmin && editingId" class="event-form">
  <div class="field">
    <label>Naslov dogaƒëaja</label>
    <input [(ngModel)]="editData.naslov" type="text" />
  </div>

  <div class="field">
    <label>Ciljna populacija:</label>
    <select [(ngModel)]="editData.ciljnaPopulacija">
      <option value="SVI">SVI</option>
      <option value="DJECA">DJECA</option>
      <option value="DJECA I MLADI">DJECA I MLADI</option>
      <option value="≈ΩENE">≈ΩENE</option>
      <option value="ODRASLI">ODRASLI</option>
      <option value="ODGAJATELJI">ODGAJATELJI</option>
      <option value="RODITELJI I BUDUƒÜI RODITELJI">RODITELJI i BUDUƒÜI RODITELJI</option>
    </select>
  </div>

  <div class="field">
    <label>Nova slika (opcionalno)</label>
    <input type="file" accept="image/*" (change)="onEditFileSelected($event)" />
  </div>

  <div class="field">
    <label>Opis</label>
    <textarea [(ngModel)]="editData.opis"></textarea>
  </div>

  <div class="field">
    <label>Datum i vrijeme</label>
    <input [(ngModel)]="editData.datumVrijeme" type="datetime-local" />
  </div>

  <div class="field">
    <label>Mjesto odr≈æavanja</label>
    <input [(ngModel)]="editData.mjesto" type="text" />
  </div>

  <div class="field">
    <label>Maksimalan broj sudionika</label>
    <input
      [(ngModel)]="editData.maxSudionika"
      type="number" min="1" step="1"
      (keydown)="blockNonNumericKey($event)" />
  </div>

  <div class="form-buttons">
    <button class="save-btn" type="button" (click)="saveEdit()" [disabled]="!isEditValid()">Spremi izmjene</button>
    <button class="cancel-btn" type="button" (click)="cancelEdit()">Odustani</button>
  </div>
</div>

<!-- FILTERI -->
<section class="events-filters">
  <div class="filters-row">
    <span class="filters-title"><strong>Filtriraj:</strong></span>

    <label>Mjesec odr≈æavanja:</label>
    <select [(ngModel)]="filters.month">
      <option value="">Svi mjeseci</option>
      <option *ngFor="let m of months" [value]="m.value">{{ m.label | uppercase }}</option>
    </select>

    <label>Ciljna populacija:</label>
    <select [(ngModel)]="filters.populacija">
      <option value="">Sve ciljne populacije</option>
      <option *ngFor="let p of populationOptions" [value]="p">{{ p }}</option>
    </select>

    <label>Status:</label>
    <select [(ngModel)]="filters.status">
      <option value="">Svi</option>
      <option value="free">SLOBODNO</option>
      <option value="full">POPUNJENO</option>
    </select>

    <button class="filter-reset" type="button"
            (click)="resetFilters()"
            *ngIf="filters.month || filters.populacija || filters.status">
      ‚úñÔ∏è Resetiraj
    </button>
  </div>
</section>

<!-- AKTIVNI DOGAƒêAJI -->
<section class="events-section">
  <h2 class="events-subheader">Aktivni dogaƒëaji</h2>

  <ng-container *ngIf="activeEvents.length; else noActive">
    <div class="events-grid">
      <app-event-card
        *ngFor="let e of activeEvents"
        [event]="e"
        [isAdmin]="isAdmin"
        (edit)="startEdit($event)"
        (remove)="deleteEvent($event)">
      </app-event-card>
    </div>
  </ng-container>
  <ng-template #noActive>
    <p class="events-empty">Trenutno nema aktivnih dogaƒëaja.</p>
  </ng-template>
</section>

<!-- ZAVR≈†ENI DOGAƒêAJI -->
<section class="events-section">
  <h2 class="events-subheader">Zavr≈°eni dogaƒëaji</h2>

  <ng-container *ngIf="finishedEvents.length; else noFinished">
    <div class="events-grid">
      <app-event-card
        *ngFor="let e of finishedEvents"
        [event]="e"
        [isAdmin]="isAdmin"
        (edit)="startEdit($event)"
        (remove)="deleteEvent($event)">
      </app-event-card>
    </div>
  </ng-container>
  <ng-template #noFinished>
    <p class="events-empty">Trenutno nema zavr≈°enih dogaƒëaja.</p>
  </ng-template>
</section>
